<%- include('partials/_header') %>

  <header class="navbar border-dark border-bottom p-1">
    <nav class="btn-group">
      <a class="btn btn-sm" href="/">Home</a>
    </nav>
    <nav class="btn-group">
      <a class="btn btn-sm" href="/logout">Logout</a>
    </nav>
  </header>

  <main class="container mt-4">
    <!-- Include CKEditor script -->
    <script src="https://cdn.ckeditor.com/ckeditor5/40.0.0/classic/ckeditor.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script>
      let editor;
      document.addEventListener('DOMContentLoaded', (event) => {
        ClassicEditor
          .create(document.querySelector('#editor'), {
            allowedContent: true, // This allows all HTML content
            // Add any additional configuration options here
          })
          .then(newEditor => {
            editor = newEditor;
            console.log(editor);

            $('#saveButton').on('click', () => {
              const updatedBody = editor.getData();

              // Extract noteId from the current URL
              const noteId = window.location.pathname.split('/').pop();

              // Send the updatedBody to the server for database update
              $.ajax({
                url: '/notes/updateNote',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                  noteId: noteId, // replace with the actual note ID
                  updatedBody: updatedBody,
                }),
                success: function (data) {
                  console.log('Success:', data);
                  // Handle success, e.g., show a success message
                },
                error: function (error) {
                  console.error('Error:', error);
                  // Handle error, e.g., show an error message
                },
              });
            });
          })
          .catch(error => {
            console.error(error);
          });
      });
    </script>

    <div id="editor">
      <!-- Use <%- %> to render HTML unescaped -->
      <%- note.body %>
    </div>


    <!-- Save button -->
    <button id="saveButton" class="btn btn-primary">Save</button>
  </main>

  <%- include('partials/_footer') %>